# 4. API è¯´æ˜

## 1. æ¦‚è¿°

 å½“å‰æ–‡æ¡£æ˜¯å…³äº **JL_OTALib.xcframework** çš„APIæ–‡æ¡£ï¼ŒåŒ…å«äº†OTAå‡çº§çš„æ‰€æœ‰APIï¼Œç”¨äºå®ç°OTAå‡çº§çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬BLEè®¾å¤‡æ¡æ‰‹è¿æ¥ï¼Œè·å–è®¾å¤‡ä¿¡æ¯ï¼ŒOTAå‡çº§èƒ½å®ç°ç­‰ã€‚

 ## 2. APIåˆ—è¡¨

| åç§°                                | åŠŸèƒ½æè¿°                                                  | å¤‡æ³¨ |
| ----------------------------------- | --------------------------------------------------------- | ---- |
| JL_OTAManager | OTAå‡çº§ç®¡ç†å¯¹è±¡ç±»ï¼Œç”¨äºç®¡ç†å‡çº§è¿‡ç¨‹                       |      |
| JLOTAFile                           | æ–‡ä»¶ä¸‹è½½ï¼Œæ ¹æ®æˆæƒçš„ key å’Œ code ä»æ°ç†æœåŠ¡å™¨ä¸‹è½½å‡çº§æ–‡ä»¶ |      |

## 3. JL_OTAManager

OTA å‡çº§ç®¡ç†å¯¹è±¡ï¼Œç”¨äºç®¡ç†è®¾å¤‡çš„å‡çº§è¿‡ç¨‹ã€‚**JL_OTAManager** æ˜¯æ°ç†ç§‘æŠ€å¼€å‘çš„ä¸€æ¬¾ä¸“ä¸š OTA å‡çº§ç®¡ç†å·¥å…·ç±»ï¼Œä¸ºå¼€å‘è€…æä¾›é«˜æ•ˆã€å®‰å…¨çš„è®¾å¤‡å›ºä»¶å‡çº§æ”¯æŒã€‚é€šè¿‡ä¸°å¯Œçš„åŠŸèƒ½æ¥å£å’Œçµæ´»çš„å›è°ƒæœºåˆ¶ï¼Œå¸®åŠ©å¼€å‘è€…è½»æ¾å®ç°è®¾å¤‡å‡çº§ç®¡ç†ã€‚

### 3.1 åˆå§‹åŒ–

1. **+ (JL_OTAManager \*)getOTAManager**  
   è·å– OTA å‡çº§ç®¡ç†å¯¹è±¡ã€‚

2. **- (instancetype)init**  
   åˆå§‹åŒ–æ–¹æ³•ï¼Œä½†å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ **getOTAManager** æ–¹æ³•è·å–å®ä¾‹ã€‚

### 3.2 ç±»å‹å®šä¹‰

#### 3.2.1 æšä¸¾ç±»å‹

1. **JL_OTAResult**  
   è¡¨ç¤º OTA å‡çº§è¿‡ç¨‹çš„ç»“æœçŠ¶æ€ã€‚

| å€¼ | æè¿° |
| --- | --- |
| `JL_OTAResultSuccess` | OTAå‡çº§æˆåŠŸ |
| `JL_OTAResultFail` | OTAå‡çº§å¤±è´¥ |
| `JL_OTAResultDataIsNull` | OTAå‡çº§æ•°æ®ä¸ºç©º |
| `JL_OTAResultCommandFail` | OTAæŒ‡ä»¤å¤±è´¥ |
| `JL_OTAResultSeekFail` | OTAæ ‡ç¤ºåç§»æŸ¥æ‰¾å¤±è´¥ |
| `JL_OTAResultInfoFail` | OTAå‡çº§å›ºä»¶ä¿¡æ¯é”™è¯¯ |
| `JL_OTAResultLowPower` | OTAå‡çº§è®¾å¤‡ç”µå‹ä½ |
| `JL_OTAResultEnterFail` | æœªèƒ½è¿›å…¥OTAå‡çº§æ¨¡å¼ |
| `JL_OTAResultUpgrading` | OTAå‡çº§ä¸­ |
| `JL_OTAResultReconnect` | OTAéœ€é‡è¿è®¾å¤‡(uuidæ–¹å¼) |
| `JL_OTAResultReboot` | OTAéœ€è®¾å¤‡é‡å¯ |
| `JL_OTAResultPreparing` | OTAå‡†å¤‡ä¸­ |
| `JL_OTAResultPrepared` | OTAå‡†å¤‡å®Œæˆ |
| `JL_OTAResultStatusIsUpdating` | è®¾å¤‡å·²åœ¨å‡çº§ä¸­ |
| `JL_OTAResultFailedConnectMore` | å½“å‰å›ºä»¶å¤šå°è®¾å¤‡è¿æ¥ï¼Œè¯·æ‰‹åŠ¨æ–­å¼€å¦ä¸€ä¸ªè®¾å¤‡è¿æ¥ |
| `JL_OTAResultFailSameSN` | å‡çº§æ•°æ®æ ¡éªŒå¤±è´¥ï¼ŒSN å¤šæ¬¡é‡å¤ |
| `JL_OTAResultCancel` | å‡çº§å–æ¶ˆ |
| `JL_OTAResultFailVerification` | å‡çº§æ•°æ®æ ¡éªŒå¤±è´¥ |
| `JL_OTAResultFailCompletely` | å‡çº§å¤±è´¥ |
| `JL_OTAResultFailKey` | å‡çº§æ•°æ®æ ¡éªŒå¤±è´¥ï¼ŒåŠ å¯†Keyä¸å¯¹ |
| `JL_OTAResultFailErrorFile` | å‡çº§æ–‡ä»¶å‡ºé”™ |
| `JL_OTAResultFailUboot` | ubootä¸åŒ¹é… |
| `JL_OTAResultFailLenght` | å‡çº§è¿‡ç¨‹é•¿åº¦å‡ºé”™ |
| `JL_OTAResultFailFlash` | å‡çº§è¿‡ç¨‹flashè¯»å†™å¤±è´¥ |
| `JL_OTAResultFailCmdTimeout` | å‡çº§è¿‡ç¨‹æŒ‡ä»¤è¶…æ—¶ |
| `JL_OTAResultFailSameVersion` | ç›¸åŒç‰ˆæœ¬ |
| `JL_OTAResultFailTWSDisconnect` | TWSè€³æœºæœªè¿æ¥ |
| `JL_OTAResultFailNotInBin` | è€³æœºæœªåœ¨å……ç”µä»“ |
| `JL_OTAResultReconnectWithMacAddr` | OTAéœ€é‡è¿è®¾å¤‡(macæ–¹å¼) |
| `JL_OTAResultDisconnect` | OTAè®¾å¤‡æ–­å¼€ |
| `JL_OTAResultReconnectUpdateSource` | OTAéœ€é‡è¿è®¾å¤‡(æ›´æ–°èµ„æº) |
| `JL_OTAResultUnknown` | OTAæœªçŸ¥é”™è¯¯ |


2. **JL_OTAReconnectType**  
   è¡¨ç¤º OTA å‡çº§å›è¿æ–¹å¼ã€‚

| å€¼                             | æšä¸¾å€¼ | æè¿°                      |
| ------------------------------ | ------ | ------------------------- |
| **JL_OTAReconnectTypeUUID**    | 0x00   | ä½¿ç”¨ UUID æ–¹å¼å›è¿è®¾å¤‡    |
| **JL_OTAReconnectTypeMACAddr** | 0x01   | ä½¿ç”¨ MAC åœ°å€æ–¹å¼å›è¿è®¾å¤‡ |

3. **JL_OtaStatus**  
   è¡¨ç¤ºè®¾å¤‡ OTA çŠ¶æ€ã€‚

| å€¼                   | æè¿°     |
| -------------------- | -------- |
| **JL_OtaStatusNormal** | æ­£å¸¸å‡çº§ |
| **JL_OtaStatusForce**  | å¼ºåˆ¶å‡çº§ |

4. **JL_OtaHeadset**  
   è¡¨ç¤ºè€³æœºå•å¤‡ä»½æ˜¯å¦éœ€è¦å¼ºåˆ¶å‡çº§ã€‚

| å€¼                 | æè¿°               |
| ------------------ | ------------------ |
| **JL_OtaHeadsetNO**  | è€³æœºå•å¤‡ä»½æ­£å¸¸å‡çº§ |
| **JL_OtaHeadsetYES** | è€³æœºå•å¤‡ä»½å¼ºåˆ¶å‡çº§ |

5. **JL_OtaWatch** âš ï¸ **å·²å¼ƒç”¨**  
   è¡¨ç¤ºæ‰‹è¡¨èµ„æºæ˜¯å¦éœ€è¦å¼ºåˆ¶å‡çº§ã€‚

   > **æ³¨æ„**ï¼šæ­¤æšä¸¾å·²è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ `JLOtaSourcesExtendMode` æ›¿ä»£ã€‚

| å€¼               | æšä¸¾å€¼ | æè¿°             |
| ---------------- | ------ | ---------------- |
| **JL_OtaWatchNO**  | 0      | æ‰‹è¡¨èµ„æºæ­£å¸¸å‡çº§ |
| **JL_OtaWatchYES** | 1      | æ‰‹è¡¨èµ„æºå¼ºåˆ¶å‡çº§ |

6. **JLOtaSourcesExtendMode** ğŸ†•  
   è¡¨ç¤º OTA èµ„æºå‡çº§æ¨¡å¼ã€‚

| å€¼                                    | æšä¸¾å€¼ | æè¿°                     |
| ------------------------------------- | ------ | ------------------------ |
| **JLSourcesExtendModeDisable**        | 0      | ä¸å¯ç”¨                   |
| **JLSourcesExtendModeNormal**         | 1      | å¯ç”¨æ™®é€šèµ„æºå‡çº§æ¨¡å¼     |
| **JLSourcesExtendModeSourceOnly**     | 2      | å¯ç”¨åªå‡çº§èµ„æºçš„æ¨¡å¼     |
| **JLSourcesExtendModeFirmwareOnly**   | 3      | å¯ç”¨åªå‡çº§å›ºä»¶ç¨‹åºçš„æ¨¡å¼ |

7. **JL_BootLoader**  
   è¡¨ç¤ºæ˜¯å¦éœ€è¦ä¸‹è½½ BootLoaderã€‚

| å€¼                 | æè¿°                  |
| ------------------ | --------------------- |
| **JL_BootLoaderNO**  | ä¸éœ€è¦ä¸‹è½½ BootLoader |
| **JL_BootLoaderYES** | éœ€è¦ä¸‹è½½ BootLoader   |

8. **JL_Partition**  
   è¡¨ç¤ºè®¾å¤‡ OTA æ—¶æ”¯æŒçš„å›ºä»¶å¤‡ä»½ç±»å‹ã€‚

| å€¼                   | æè¿°       |
| -------------------- | ---------- |
| **JL_PartitionSingle** | å›ºä»¶å•å¤‡ä»½ |
| **JL_PartitionDouble** | å›ºä»¶åŒå¤‡ä»½ |

### 3.3 å±æ€§

| å±æ€§å                                | ç±»å‹                        | æè¿°                                    |
| ------------------------------------- | --------------------------- | --------------------------------------- |
| **mBLE_UUID**                         | **NSString**                | è®¾å¤‡ UUIDï¼ˆéœ€è¦å¼€å‘è€…å¡«å…¥ï¼‰             |
| **mBLE_NAME**                         | **NSString**                | è®¾å¤‡åç§°ï¼ˆéœ€è¦å¼€å‘è€…å¡«å…¥ï¼‰              |
| **bleOnly**                           | **BOOL**                    | æ˜¯å¦ä»…ä»…æ”¯æŒ BLE                       |
| **bleAddr**                           | **NSString**                | BLE è“ç‰™åœ°å€                           |
| **mCmdSN**                            | **uint8_t**                 | SN å€¼                                   |
| **version**                           | **uint16_t**                | è®¾å¤‡ç‰ˆæœ¬å·                              |
| **versionFirmware**                   | **NSString**                | è®¾å¤‡ç‰ˆæœ¬ä¿¡æ¯                            |
| **otaStatus**                         | **JL_OtaStatus**            | è®¾å¤‡ OTA çŠ¶æ€                          |
| **otaHeadset**                        | **JL_OtaHeadset**           | è€³æœºå•å¤‡ä»½æ˜¯å¦éœ€è¦å¼ºåˆ¶å‡çº§              |
| **otaWatch** âš ï¸ **å·²å¼ƒç”¨**            | **JL_OtaWatch**             | æ‰‹è¡¨èµ„æºæ˜¯å¦éœ€è¦å¼ºåˆ¶å‡çº§ï¼ˆå·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ otaSourceModeï¼‰ |
| **isSupportReuseSpaceOTA**            | **BOOL**                    | æ˜¯å¦æ”¯æŒå¤ç”¨ç©ºé—´è¿›è¡Œ OTA                |
| **otaSourceMode**                     | **JLOtaSourcesExtendMode**  | èµ„æºå‡çº§æ¨¡å¼ç±»å‹                        |
| **otaPartition**                      | **JL_Partition**            | è®¾å¤‡ OTA æ—¶æ”¯æŒå•/åŒå¤‡ä»½                |
| **bootloaderType**                    | **JL_BootLoader**           | è®¾å¤‡æ˜¯å¦éœ€è¦ä¸‹è½½ Loader                 |
| **otaReconnectType**                  | **JL_OTAReconnectType**     | OTA å‡çº§å›è¿æ–¹å¼                        |
| **otaLength** (åªè¯»)                  | **int64_t**                 | OTA å‡çº§å†…å®¹å¤§å°ï¼ˆè®¾å¤‡é€šçŸ¥çš„ï¼‰          |
| **otaSent** (åªè¯»)                    | **uint32_t**                | å·²ä¼ è¾“çš„æ•°æ®å¤§å°                        |
| **delegate**                          | **id<JL_OTAManagerDelegate>** | è®¾å¤‡äº¤äº’å›è°ƒä»£ç†                        |

### 3.4 æ–¹æ³•

#### 3.4.1 ç±»æ–¹æ³•

1. **+ (JL_OTAManager *)getOTAManager**  
   è·å– OTA å‡çº§å¯¹è±¡ã€‚

2. **+ (NSString *)logSDKVersion**  
   æ‰“å° OTA SDK ç‰ˆæœ¬ã€‚

#### 3.4.2 åˆå§‹åŒ–æ–¹æ³•

1. **- (instancetype)init** âš ï¸ **å·²å¼ƒç”¨**  
   ä¸å»ºè®®ä½¿ç”¨è‡ªè¡Œåˆå§‹åŒ–ï¼Œæ¨èè·å– `getOTAManager`ã€‚

#### 3.4.3 é…ç½®æ–¹æ³•

1. **- (void)logSendData:(BOOL)status**  
   æ‰“å° OTA å‘é€çš„æ•°æ®å†…å®¹ã€‚

   **å‚æ•°**:
   - **status**: å¼€å…³çŠ¶æ€

2. **- (void)maxLostCount:(int)count**  
   è®¾ç½®æœ€å¤§ä¸¢åŒ…æ¬¡æ•°ã€‚

   **å‚æ•°**:
   - **count**: æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼š10ï¼‰

3. **- (void)cmdTimeOut:(int)timeOut**  
   è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚

   **å‚æ•°**:
   - **timeOut**: æ—¶é—´ï¼ˆé»˜è®¤å€¼ï¼š5ï¼‰

4. **- (void)setOTARelink:(BOOL)isReLink** âš ï¸ **å·²å¼ƒç”¨**  
   è®¾ç½®æ˜¯å¦éœ€è¦å›è¿ã€‚ä¸€èˆ¬ä¸å…è®¸å¤–éƒ¨å¹²æ‰°çŠ¶æ€æœºï¼Œå¤–éƒ¨ä¸é€‚ç”¨æ­¤æ–¹æ³•ã€‚

   **å‚æ•°**:
   - **isReLink**: å›è¿çŠ¶æ€

#### 3.4.4 è¿æ¥ç®¡ç†

1. **- (void)noteEntityConnected**  
   å½“ BLE è¿æ¥ä¸Šæ—¶å‘ŠçŸ¥ SDKã€‚

2. **- (void)noteEntityDisconnected**  
   å½“ BLE æ–­å¼€æ—¶å‘ŠçŸ¥ SDKã€‚

#### 3.4.5 æ•°æ®æ¥æ”¶

1. **- (void)cmdOtaDataReceive:(NSData *)data**  
   æ¥æ”¶æ¥è‡ª RCSP çš„è®¾å¤‡ç«¯æ•°æ®ã€‚

   **å‚æ•°**:
   - **data**: è®¾å¤‡ç«¯ä¼ æ¥çš„æ•°æ®

#### 3.4.6 çŠ¶æ€æŸ¥è¯¢

1. **- (void)cmdTargetFeature**  
   æŸ¥è¯¢è®¾å¤‡ OTA ä¿¡æ¯ã€‚æ‰€æœ‰æƒ…å†µä¸‹éƒ½éœ€è¦æ‰§è¡Œï¼Œè€Œä¸”æ˜¯åœ¨è¿ä¸Šåï¼ˆè®¤è¯å®Œæˆï¼‰ç¬¬ä¸€æ­¥æ‰§è¡Œã€‚

2. **- (void)cmdSystemFunction**  
   æŸ¥è¯¢è®¾å¤‡ç³»ç»ŸçŠ¶æ€ã€‚å½“è®¾å¤‡éœ€è¦æŒ‚è½½å¤–ç½® flash æ‰èƒ½æ­£å¸¸å‡çº§æ—¶éœ€è¦æ‰§è¡Œï¼Œå…¶ä»–æƒ…å†µåˆ™æ— éœ€æ‰§è¡Œã€‚

3. **- (BOOL)cmdOtaIsRelinking**  
   OTA å•å¤‡ä»½ï¼Œæ˜¯å¦æ­£åœ¨å›è¿ã€‚

#### 3.4.7 OTA å‡çº§æ“ä½œ

1. **- (void)cmdOTAData:(NSData \*)data Result:(JL_OTA_RT __nullable)result**  
   å¼€å§‹ OTA å‡çº§ã€‚

   **å‚æ•°**:
   - **data**: å‡çº§æ•°æ®
   - **result**: å‡çº§ç»“æœå›è°ƒ

2. **- (void)cmdOtaDataIIResult:(JL_OTA_RT __nullable)result**  
   
   OTA å‡çº§ IIï¼ˆå•å¤‡ä»½å‡çº§ç‰¹æœ‰ï¼‰ã€‚æ­¤æ¥å£å¯ç”¨äº OTA å›è¿æˆåŠŸåï¼Œå†æ¬¡å‘èµ·å‡çº§ä½¿ç”¨ã€‚

   **å‚æ•°**:
   - **result**: å‡çº§ç»“æœå›è°ƒ

3. **- (void)cmdUpgrade:(NSData \*)data Option:(JLOtaReConnectOption \*_Nullable)option Result:(JL_OTA_RT _Nonnull)result**  
   
   OTA å‡çº§ IIIï¼ˆå•å¤‡ä»½å‡çº§ç‰¹æœ‰ï¼‰ã€‚æ­¤æ¥å£å…å»äº†å…¬ç‰ˆ OTA çš„å¤–è¾¹å›è¿ç­–ç•¥ï¼Œå†…éƒ¨å®ç°å›è¿ã€‚

   > âš ï¸ **æ³¨æ„**ï¼šä½¿ç”¨æ­¤æ–¹æ³•æ—¶ä¸å¯ä½¿ç”¨ delegate çš„å›è°ƒä¿¡æ¯ï¼Œè¦ä½¿ç”¨ Result çš„å›è°ƒä¿¡æ¯ã€‚

   **å‚æ•°**:
   - **data**: OTA æ•°æ®
   - **option**: å›è¿é€‰é¡¹
   - **result**: å›å¤å›è°ƒ

4. **- (void)cmdOTACancelResult:(JL_OTA_RESULT __nullable)result**  
   OTA å‡çº§å–æ¶ˆã€‚

   **å‚æ•°**:
   - **result**: å›å¤å›è°ƒ

#### 3.4.8 è®¾å¤‡æ“ä½œ

1. **- (void)cmdRebootDevice**  
   é‡å¯è®¾å¤‡ã€‚

2. **- (void)cmdRebootForceDevice**  
   å¼ºåˆ¶é‡å¯è®¾å¤‡ã€‚

3. **- (void)resetOTAManager**  
   é‡ç½® OTA managerã€‚

### 3.5 å›è°ƒåè®®

**JL_OTAManagerDelegate**

| æ–¹æ³•                                                         | æè¿°               |
| ------------------------------------------------------------ | ------------------ |
| **- (void)otaDataSend:(NSData \*)data**                         | æ•°æ®å‘é€å›è°ƒ       |
| **- (void)otaFeatureResult:(JL_OTAManager \*)manager**          | è®¾å¤‡çŠ¶æ€ä¿¡æ¯å›è°ƒ   |
| **- (void)otaUpgradeResult:(JL_OTAResult)result Progress:(float)progress** | å‡çº§çŠ¶æ€ä¸è¿›åº¦å›è°ƒ |
| **- (void)otaCancel**                                          | OTA å‡çº§å–æ¶ˆå›è°ƒ   |

## 4. JLOTAFile

**JLOTAFile** æ˜¯æ°ç†ç§‘æŠ€æä¾›çš„ OTA æ–‡ä»¶ç®¡ç†ç±»ï¼Œä¸»è¦ç”¨äºæ”¯æŒ OTA å‡çº§æ–‡ä»¶çš„ä¸‹è½½å’Œç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡ç®€å•çš„æ¥å£è°ƒç”¨ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾è·å–å›ºä»¶æ–‡ä»¶å¹¶å®ç°ç›¸å…³ä¸šåŠ¡é€»è¾‘ã€‚

### 4.1 ç±»å‹å®šä¹‰

#### 4.1.1 æšä¸¾ç±»å‹

1. **JL_OTAUrlResult**  
   è¡¨ç¤º OTA æ–‡ä»¶è·å–çš„ç»“æœçŠ¶æ€ã€‚

| å€¼                            | æè¿°             |
| ----------------------------- | ---------------- |
| **JL_OTAUrlResultSuccess**      | OTA æ–‡ä»¶è·å–æˆåŠŸ |
| **JL_OTAUrlResultFail**         | OTA æ–‡ä»¶è·å–å¤±è´¥ |
| **JL_OTAUrlResultDownloadFail** | OTA æ–‡ä»¶ä¸‹è½½å¤±è´¥ |

#### 4.1.2 å›è°ƒç±»å‹

1. **JL_OTA_URL**  
   æ–‡ä»¶ä¸‹è½½ç»“æœçš„å›è°ƒç±»å‹ã€‚

**å‚æ•°è¯´æ˜**ï¼š

- **result**ï¼šç»“æœçŠ¶æ€ï¼Œå¯¹åº” **JL_OTAUrlResult** æšä¸¾å€¼ã€‚
- **version**ï¼šæ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯èƒ½ä¸ºç©ºã€‚
- **url**ï¼šä¸‹è½½é“¾æ¥åœ°å€ï¼Œå¯èƒ½ä¸ºç©ºã€‚
- **explain**ï¼šæ–‡ä»¶è¯´æ˜ä¿¡æ¯ï¼Œå¯èƒ½ä¸ºç©ºã€‚

``` objective-c
typedef void(^JL_OTA_URL)(JL_OTAUrlResult result,
                          NSString* __nullable version,
                          NSString* __nullable url,
                          NSString* __nullable explain);
``` 


### 4.2 æ–¹æ³•

#### 4.2.1 æ–‡ä»¶ä¸‹è½½

1. **-(void)cmdGetOtaFileKey:(NSString\*)key Code:(NSString\*)code Result:(JL_OTA_URL __nullable)result**

**æè¿°**ï¼š
æ ¹æ®æˆæƒ **key** å’Œ **code**ï¼Œä¸‹è½½æŒ‡å®šçš„ OTA å‡çº§æ–‡ä»¶ã€‚

**å‚æ•°**ï¼š

- **key**ï¼šæˆæƒçš„å¯†é’¥ã€‚
- **code**ï¼šæˆæƒç ã€‚
- **result**ï¼šä¸‹è½½ç»“æœå›è°ƒï¼Œè¿”å›æ–‡ä»¶ä¿¡æ¯å’ŒçŠ¶æ€ã€‚

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

``` objective-c
JLOTAFile *otaFile = [[JLOTAFile alloc] init];
[otaFile cmdGetOtaFileKey:@"yourKey"
                     Code:@"yourCode"
                   Result:^(JL_OTAUrlResult result, NSString * _Nullable version, NSString * _Nullable url, NSString * _Nullable explain) {
    if (result == JL_OTAUrlResultSuccess) {
        NSLog(@"æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼Œç‰ˆæœ¬ï¼š%@ï¼Œé“¾æ¥ï¼š%@ï¼Œè¯´æ˜ï¼š%@", version, url, explain);
    } else {
        NSLog(@"æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼ŒçŠ¶æ€ï¼š%d", result);
    }
}];
``` 

2. **-(void)cmdGetOtaFileKey:(NSString\*)key Code:(NSString\*)code hash:(NSString\*)hash Result:(JL_OTA_URL __nullable)result**

**æè¿°**ï¼š
æ ¹æ®æˆæƒ **key**ã€**code** å’Œæ–‡ä»¶ **MD5** å€¼ï¼Œä¸‹è½½æŒ‡å®šçš„ OTA å‡çº§æ–‡ä»¶ã€‚

**å‚æ•°**ï¼š

- **key**ï¼šæˆæƒçš„å¯†é’¥ã€‚
- **code**ï¼šæˆæƒç ã€‚
- **hash**ï¼šæ–‡ä»¶çš„ MD5 å€¼ï¼Œç”¨äºæ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§ã€‚
- **result**ï¼šä¸‹è½½ç»“æœå›è°ƒï¼Œè¿”å›æ–‡ä»¶ä¿¡æ¯å’ŒçŠ¶æ€ã€‚

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

``` objective-c
[otaFile cmdGetOtaFileKey:@"yourKey"
                     Code:@"yourCode"
                     hash:@"yourFileMD5"
                   Result:^(JL_OTAUrlResult result, NSString * _Nullable version, NSString * _Nullable url, NSString * _Nullable explain) {
    if (result == JL_OTAUrlResultSuccess) {
        NSLog(@"æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼Œç‰ˆæœ¬ï¼š%@ï¼Œé“¾æ¥ï¼š%@ï¼Œè¯´æ˜ï¼š%@", version, url, explain);
    } else {
        NSLog(@"æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼ŒçŠ¶æ€ï¼š%d", result);
    }
}];
``` 

---

### 4.3 æ³¨æ„äº‹é¡¹

1. ç¡®ä¿ **key** å’Œ **code** çš„æœ‰æ•ˆæ€§ï¼Œé¿å…å› æˆæƒå¤±è´¥å¯¼è‡´æ–‡ä»¶æ— æ³•ä¸‹è½½ã€‚
2. å¦‚æœä½¿ç”¨ MD5 æ ¡éªŒï¼Œè¯·æ­£ç¡®ä¼ å…¥æ–‡ä»¶çš„ **hash** å€¼ï¼Œä»¥ç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§ã€‚
3. å›è°ƒå‚æ•° **version**ã€**url** å’Œ **explain** å¯èƒ½ä¸ºç©ºï¼Œè¯·åœ¨ä½¿ç”¨å‰è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥ã€‚
4. ä¸ºäº†æé«˜ä¸‹è½½çš„ç¨³å®šæ€§ï¼Œå»ºè®®åœ¨å¤±è´¥æ—¶æ·»åŠ é‡è¯•æœºåˆ¶ã€‚

